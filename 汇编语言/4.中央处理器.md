# 4.中央处理器(80x86)
### CPU 的任务
- 执行放在内存中的指令序列;
- 负责 CPU 和存储器(内存)以及 I/O 间的数据传输任务。

### CPU 的组成
- 算数逻辑部分: 算数和逻辑运算;
- 控制逻辑
- 工作寄存器

#### 控制逻辑
- 负责对全机的控制工作;
- 从存储器取出指令;
- 对指令进行译码分析;
- 从存储器取得操作数;
- 发出执行指令的所有的命令;
- 把结果存入存储器;
- 对总线及I/O传送的控制等。

#### 工作寄存器
- 每个工作寄存器都相当于存储器的一个存储单元;
- 但它的存取速度比存储器快得多;
- 用来存放计算过程中所需要或者所得到的各种信息: 操作数地址, 操作数及运算的中间结果等。
 
### 寄存器
- 通用寄存器
- 专用寄存器
- 段寄存器

#### 通用寄存器
##### 数据寄存器
- AX, BX, CX, DX;
- 用来暂时存放计算过程中所用到的操作数, 结果等;
- 都可以通过 字(16位) 或者 字节(8位, 高8位:低8位)的方式应用;
- AX = AH:AL, 其余3个一样。
```
例: 赋值操作 X = 1234H
16 位应用 AX:
	MOV AX, 1234H
8 位应用 AH:
	MOV AH, 12H
```

##### 指针及变址寄存器
- SP, BP, SI, DI;
- 只能通过 16位(字)的方式应用;
- 作用: 在段内寻址时提供偏移地址(相对地址);
- SP(Stack Pointer): 堆栈指针寄存器;
- BP(Base Pointer): 基址指针寄存器;
- SI(Source Index): 源变址寄存器, 对应的段寄存器: DS;
- DI(Destination Index): 目的变址寄存器, 对应的段寄存器: ES;

#### 专用寄存器
- IP, SP, PSW 3个 16位寄存器;
##### IP(Instruction Pointer): 指令指针寄存器
- 用来存放代码段中的偏移地址(相对地址);
- 程序运行过程中, 它始终指向下一条指令的首地址;
- 和代码段的段寄存器(CS)联用确定下一条指令的物理地址;
- 当这一条地址送到存储器后, 控制器就可以取得下一条要执行的指令;
- 控制器一旦取得这条指令, 就马上修改 IP 内容, 使它指向下一条指令的首地址。
- 计算机使用 IP寄存器来控制指令序列的执行流程。

##### SP: 堆栈指针寄存器
- 与堆栈段寄存器联用确定堆栈段中栈顶的地址, 用来指示栈顶的偏移地址。

##### PSW(Program Status Word): 程序状态字寄存器
- 用来标记, eg: 记录补码相加时最高有效位产生的进位值;
- 由条件码标志位(flag), 控制标志位, 系统标志位组成。

###### 条件码标志位
- OF(Overflow Flag): 溢出标志, 运算过程中操作数超出机器能表示的范围, 1 表示溢出;
- SF(Sign Flag): 符号标志, 1 表示运算结果符号为负;
- ZF(Zero Flag): 零标志, 运算结果为 0 时置 1, 否则置0;
- CF(Carry Flag): 进位标志, 记录运算时从最高有效位产生的进位值, 1 表示有进位;

###### 控制标志位
-DF(Direction Flag): 方向标志, 在串处理指令中控制处理信息的方向,  
    DF 位为 1 时, 每次操作后 SI 和 DI 减量, 串处理从高地址向低地址方向处理,  
    DF 位为 0 时, SI 和 DI 增量, 串处理从低地址向高地址方向处理。

###### 系统标志位
- IF(Interrupt Flag): 中断标志位, IF 为 0 时允许中断, 否则关闭中断;
- TF(Trap Flag): 陷阱标志位, TF 位为 1 时每条指令执行完后产生陷阱, 由系统控制计算机, eg: TF 为 1 进入中断, 中断完成后控制权交还 CPU。

#### 段寄存器
- CS(Code Segment): 代码段寄存器, 存放当前正运行的程序;
- DS(Data Segment): 数据段寄存器, 存放当前运行程序所用的数据;
- SS(Stack Segment): 堆栈段, 定义了堆栈的所在区域;
- ES(Extra Segment): 附加段, 附加的数据段, 是一个辅助的数据区, 也是串处理指令的目的操作数存放区。

#### 物理地址
- 基址寄存器为 BX 时, 使用 DS 作为段寄存器;
- 基址寄存器为 BP 时, 使用 SS 作为段寄存器;
- 物理地址 = 16D * DS + BX + SI + 位偏移量;
